<html>
  <head>
    <meta charset="utf-8" />
    <title>Deck.gl Antimeridian</title>

    <!-- deck.gl standalone bundle -->
    <script src="https://unpkg.com/deck.gl@^9.0.0-beta.2/dist.min.js"></script>

    <style type="text/css">
      body {margin: 0; padding: 0; font-family: sans-serif;}
      #container {width: 100vw; height: 100vh;}
      #controls {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 1000;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 8px 12px;
        border-radius: 4px;
        min-width: 200px;
      }
      #controls label {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      #datasetSelect {
        margin-top: 4px;
        width: 180px;
        padding: 4px;
      }
      #antimeridianControl {
        display: none;
        margin-top: 8px;
        font-size: 11px;
        line-height: 1.4;
      }
      #antimeridianControl label {
        text-transform: none;
        letter-spacing: normal;
        font-size: 11px;
      }
      #antimeridianControl a {
        color: #7fe1ff;
      }
    </style>
  </head>

  <body>
    <div id="controls">
      <label for="datasetSelect">H3 Dataset</label><br />
      <select id="datasetSelect">
        <option value="data/h3_0_origin.geojson">H3 origin</option>
        <option value="data/h3_0_shift_west.geojson">H3 shifting</option>
        <option value="data/h3_0_split.geojson">H3 splitting</option>
      </select>
      <div id="antimeridianControl">
        <input type="checkbox" id="antimeridianToggle" />
        <label for="antimeridianToggle">Enable wrapLongitude</label>
      </div>
    </div>
    <div id="container"></div>
  </body>

  <script type="text/javascript">

const DATASETS = [
  'data/h3_0_origin.geojson',
  'data/h3_0_shift_west.geojson',
  'data/h3_0_split.geojson'
];
const DARK_TILES = 'https://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png';

const datasetSelect = document.getElementById('datasetSelect');
const antimeridianControl = document.getElementById('antimeridianControl');
const antimeridianToggle = document.getElementById('antimeridianToggle');

function isOriginDataset() {
  return datasetSelect.value === DATASETS[0];
}

function wrapLongitudeEnabled() {
  return isOriginDataset() && antimeridianToggle.checked;
}

function toggleAntimeridianControl() {
  const originSelected = isOriginDataset();
  antimeridianControl.style.display = originSelected ? 'block' : 'none';
  if (!originSelected) {
    antimeridianToggle.checked = false;
  }
}

function buildLayers(selectedData) {
  const wrapEnabled = wrapLongitudeEnabled();
  return [
    new deck.TileLayer({
      id: 'dark-basemap',
      data: DARK_TILES,
      minZoom: 0,
      maxZoom: 19,
      tileSize: 256,
      renderSubLayers: props => {
        const {
          bbox: {west, south, east, north}
        } = props.tile;
        return new deck.BitmapLayer(props, {
          data: null,
          image: props.data,
          bounds: [west, south, east, north]
        });
      }
    }),
    new deck.GeoJsonLayer({
      id: `h3-layer-${selectedData}-${wrapEnabled ? 'wrapped' : 'clamped'}`,
      data: selectedData,
      stroked: true,
      filled: true,
      wrapLongitude: wrapEnabled,
      lineWidthMinPixels: 1,
      getLineColor: [255, 0, 0],
      getFillColor: [255, 0, 0, 0.08],
      pickable: true,
      autoHighlight: true
    })
  ];
}

const deckgl = new deck.DeckGL({
  container: 'container',
  views: new deck.MapView({repeat: true}),
  initialViewState: {
    latitude: 0,
    longitude: 0,
    zoom: 0,
    bearing: 0,
    pitch: 0
  },
  controller: true
});

function updateDeck() {
  deckgl.setProps({
    layers: buildLayers(datasetSelect.value)
  });
}

datasetSelect.addEventListener('change', () => {
  toggleAntimeridianControl();
  updateDeck();
});

antimeridianToggle.addEventListener('change', () => {
  updateDeck();
});

toggleAntimeridianControl();
updateDeck();
  </script>
</html>